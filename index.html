<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cursor Persist</title>
</head>
<body>
  <!--
    Invisible widget that:
     ‚Ä¢ Drives the Event table‚Äôs master cursor
     ‚Ä¢ Persists every selected Event.id
     ‚Ä¢ Restores that selection on every page load
    No column chooser will ever appear‚Äîonly Event.id is mapped.
  -->

  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  <script>
    // Initialize plugin:
    //  - full access so setCursorPos() works
    //  - columns:['id'] forces binding to only the id column (no chooser)
    //  - allowSelectBy:true lets this widget drive the shared cursor
    grist.ready({
      requiredAccess: 'full',
      columns: ['id'],
      allowSelectBy: true
    });

    const STORAGE_KEY = 'persist_cursor_Event';

    // Save {tableId, rowId, colId} every time Event.id changes
    grist.onRecord(record => {
      if (record && record.id != null) {
        const cursor = { tableId: 'Event', rowId: record.id, colId: 'id' };
        sessionStorage.setItem(STORAGE_KEY, JSON.stringify(cursor));
        console.log('üíæ Stored Event cursor:', cursor);
      }
    });

    // Restore that cursor on each page load, after a short pause
    window.addEventListener('load', () => {
      setTimeout(async () => {
        const raw = sessionStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        try {
          const {tableId, rowId, colId} = JSON.parse(raw);
          await grist.setCursorPos({tableId, rowId, colId});
          console.log('‚úÖ Restored global cursor to', tableId, rowId, colId);
        } catch (err) {
          console.warn('‚ö†Ô∏è Failed to restore cursor:', err);
        }
      }, 200);
    });
  </script>
</body>
</html>


