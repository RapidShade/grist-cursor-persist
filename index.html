<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cursor Persist</title>
</head>
<body>
  <!-- Invisible widget that persists & restores the Event.id selection -->

  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>
  <script>
    // 1) Init plugin:
    grist.ready({
      requiredAccess: 'full',  // so setSelectedRows() will work
      columns: ['id'],         // hard‚Äêwire to your Event.id
      allowSelectBy: true      // so linked widgets listen
    });

    const KEY = 'persist_cursor_Event';

    // 2) Whenever the user picks an Event in this widget, save its id
    grist.onRecord(record => {
      if (record && record.id != null) {
        sessionStorage.setItem(KEY, record.id);
        console.log('üíæ Stored Event ID:', record.id);
      }
    });

    // 3) On page load, restore that selection as the widget‚Äôs selectedRows
    window.addEventListener('load', () => {
      setTimeout(async () => {
        const raw = sessionStorage.getItem(KEY);
        if (!raw) { return; }
        const rowId = Number(raw);
        try {
          await grist.setSelectedRows([rowId]);
          console.log('‚úÖ Restored selectedRows to Event ID', rowId);
        } catch (err) {
          console.warn('‚ö†Ô∏è Failed to restore selection:', err);
        }
      }, 200); // let Grist finish loading
    });
  </script>
</body>
</html>




